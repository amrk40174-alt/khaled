# ุฅุตูุงุญ ุนุฑุถ ุงููุฏููุนุงุช ูู ูุงุฆูุฉ ุงูููุงุชูุฑ ููุดููุฉ ุงูุตูุญุฉ ุงููุงุฑุบุฉ โ

## ๐จ ุงููุดุงูู ุงูุชู ุชู ุญููุง:

### 1. **ุนุฑุถ ุงููุฏููุนุงุช ูู ูุงุฆูุฉ ุงูููุงุชูุฑ**
- โ **ุงููุดููุฉ**: ุงููุฏููุนุงุช ูุงููุชุจูู ูุง ูุธูุฑุงู ุฏุงุฆูุงู ูู ูุงุฆูุฉ ุงูููุงุชูุฑ
- โ **ุงูุญู**: ุชุญุฏูุซ ุงูุนุฑุถ ููุธูุฑ ุงููุฏููุนุงุช ูุงููุชุจูู ุฏุงุฆูุงู ูุฌููุน ุงูููุงุชูุฑ
- โ **ุงููุชูุฌุฉ**: ูู ูุงุชูุฑุฉ ุชุธูุฑ ุงููุจูุบ ุงููุฏููุน (ุฃุฎุถุฑ) ูุงููุชุจูู (ุฃุญูุฑ)

### 2. **ูุดููุฉ ุงูุตูุญุฉ ุงููุงุฑุบุฉ ุนูุฏ ุงูุฎุฑูุฌ ูู ุงูุชูุงุตูู**
- โ **ุงููุดููุฉ**: ุนูุฏ ุงูุฎุฑูุฌ ูู ุชูุงุตูู ุงููุงุชูุฑุฉ ุชุธูุฑ ุตูุญุฉ ูุงุฑุบุฉ
- โ **ุงูุญู**: ุฅุตูุงุญ props ูู InvoiceDetails ูู `isOpen/onClose` ุฅูู `open/onOpenChange`
- โ **ุงููุชูุฌุฉ**: ุงูุฎุฑูุฌ ุงูุณููู ุฅูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ

### 3. **ุชุญุฏูุซ ุชููุงุฆู ุดุงูู ูููุฏููุนุงุช**
- โ **ุงูุญู**: ุฅุถุงูุฉ ุชุญุฏูุซ ุชููุงุฆู ููุงุฆูุฉ ุงูููุงุชูุฑ ุนูุฏ ุฅุถุงูุฉ/ุญุฐู ุงููุฏููุนุงุช
- โ **ุงููุชูุฌุฉ**: ุชุฒุงูู ููุฑู ุจูู ุฌููุน ุฃุฌุฒุงุก ุงูุชุทุจูู

## ๐ฏ ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

### 1. **ูู ูุงุฆูุฉ ุงูููุงุชูุฑ**:
```typescript
// ูุจู ุงูุฅุตูุงุญ:
{invoice.paid_amount > 0 && (
  <div className="text-xs space-y-1 mt-1">
    <p className="text-green-600">ูุฏููุน: {invoice.paid_amount.toFixed(2)} ุฌ.ู</p>
    // ูุธูุฑ ููุท ุฅุฐุง ูุงู ููุงู ูุฏููุนุงุช
  </div>
)}

// ุจุนุฏ ุงูุฅุตูุงุญ:
<div className="text-xs space-y-1 mt-1">
  <p className="text-green-600">ูุฏููุน: {(invoice.paid_amount || 0).toFixed(2)} ุฌ.ู</p>
  <p className="text-red-600">ูุชุจูู: {(invoice.remaining_amount || invoice.amount).toFixed(2)} ุฌ.ู</p>
  // ูุธูุฑ ุฏุงุฆูุงู ูุฌููุน ุงูููุงุชูุฑ
</div>
```

### 2. **ูู ูููู InvoiceDetails**:
```typescript
// ูุจู ุงูุฅุตูุงุญ:
<Dialog open={isOpen} onOpenChange={onClose}>

// ุจุนุฏ ุงูุฅุตูุงุญ:
<Dialog open={open} onOpenChange={onOpenChange}>
```

### 3. **ูู ุตูุญุฉ ุงูููุงุชูุฑ**:
```typescript
// ูุจู ุงูุฅุตูุงุญ:
<InvoiceDetails
  invoice={selectedInvoice}
  isOpen={isDetailsOpen}
  onClose={() => {
    setIsDetailsOpen(false);
    setSelectedInvoice(null);
  }}
/>

// ุจุนุฏ ุงูุฅุตูุงุญ:
<InvoiceDetails
  invoice={selectedInvoice}
  open={isDetailsOpen}
  onOpenChange={(open) => {
    setIsDetailsOpen(open);
    if (!open) {
      setSelectedInvoice(null);
    }
  }}
/>
```

### 4. **ุชุญุฏูุซ hook ุงูููุงุชูุฑ**:
```typescript
// ุชุญุฏูุซ useInvoices ูุฌูุจ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ
export const useInvoices = () => {
  return useQuery({
    queryKey: ['invoices'],
    queryFn: async () => {
      const { data: invoices, error } = await supabase
        .from('invoices')
        .select('*')
        .order('created_at', { ascending: false });

      return invoices?.map(invoice => ({
        ...invoice,
        paid_amount: invoice.paid_amount || 0,
        remaining_amount: invoice.remaining_amount !== undefined ? invoice.remaining_amount : invoice.amount,
      })) || [];
    },
    staleTime: 2 * 60 * 1000, // ุชุญุฏูุซ ุฃุณุฑุน ูููุฏููุนุงุช
  })
}
```

### 5. **ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุฅุถุงูุฉ/ุญุฐู ุงููุฏููุนุงุช**:
```typescript
// ูู PaymentDialog ู PaymentsList
// ุนูุฏ ุฅุถุงูุฉ ุฃู ุญุฐู ุฏูุนุฉ:
queryClient.invalidateQueries({ queryKey: ['invoices'] });
queryClient.invalidateQueries({ queryKey: ['payments'] });
queryClient.invalidateQueries({ queryKey: ['merchants-with-stats'] });
```

## ๐ ุงููุชุงุฆุฌ ุงูุขู:

### โ **ูู ูุงุฆูุฉ ุงูููุงุชูุฑ**:
```
ุจุทุงูุฉ ุงููุงุชูุฑุฉ:
โโโ ุฅุฌูุงูู ุงููุงุชูุฑุฉ: 1000 ุฌ.ู
โโโ ูุฏููุน: 400 ุฌ.ู (ุฃุฎุถุฑ) โ ูุธูุฑ ุฏุงุฆูุงู
โโโ ูุชุจูู: 600 ุฌ.ู (ุฃุญูุฑ) โ ูุธูุฑ ุฏุงุฆูุงู
โโโ ุงูุญุงูุฉ: ูุฏููุนุฉ ุฌุฒุฆูุงู
```

### โ **ุนูุฏ ูุชุญ ุชูุงุตูู ุงููุงุชูุฑุฉ**:
- ุชูุชุญ ุงูุชูุงุตูู ุจุดูู ุตุญูุญ
- ุชุธูุฑ ุฌููุน ุงููุนูููุงุช ูุญุฏุซุฉ
- ูููู ุฅุถุงูุฉ/ุญุฐู ุงููุฏููุนุงุช

### โ **ุนูุฏ ุงูุฎุฑูุฌ ูู ุงูุชูุงุตูู**:
- ูุนูุฏ ุฅูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ ูุจุงุดุฑุฉ
- ูุง ุชูุฌุฏ ุตูุญุฉ ูุงุฑุบุฉ
- ุงูุจูุงูุงุช ูุญุฏุซุฉ ุชููุงุฆูุงู

### โ **ุงูุชุญุฏูุซ ุงูุชููุงุฆู**:
- ุนูุฏ ุฅุถุงูุฉ ุฏูุนุฉ โ ุชุชุญุฏุซ ูุงุฆูุฉ ุงูููุงุชูุฑ ููุฑุงู
- ุนูุฏ ุญุฐู ุฏูุนุฉ โ ุชุชุญุฏุซ ูุงุฆูุฉ ุงูููุงุชูุฑ ููุฑุงู
- ุชุฒุงูู ูุงูู ุจูู ุฌููุน ุงูุตูุญุงุช

## ๐ฏ ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช:

### 1. **ุงุฎุชุจุงุฑ ุนุฑุถ ุงููุฏููุนุงุช**:
- ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูููุงุชูุฑ
- ุณุชุฌุฏ ูู ูุงุชูุฑุฉ ุชุธูุฑ:
  - ุงููุจูุบ ุงูุฅุฌูุงูู
  - ุงููุจูุบ ุงููุฏููุน (ุฃุฎุถุฑ)
  - ุงููุจูุบ ุงููุชุจูู (ุฃุญูุฑ)
  - ุงูุญุงูุฉ

### 2. **ุงุฎุชุจุงุฑ ุงูุชูุงุตูู ูุงูุฎุฑูุฌ**:
- ุงููุฑ ุนูู ุฃู ูุงุชูุฑุฉ ููุชุญ ุงูุชูุงุตูู
- ุฃุถู ุฃู ุงุญุฐู ุฏูุนุฉ
- ุงููุฑ ุฎุงุฑุฌ ุงููุงูุฐุฉ ุฃู ุฒุฑ ุงูุฅุบูุงู
- ุณุชุนูุฏ ุฅูู ุตูุญุฉ ุงูููุงุชูุฑ ูุจุงุดุฑุฉ (ูุง ุตูุญุฉ ูุงุฑุบุฉ)

### 3. **ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู**:
- ุงูุชุญ ุชูุงุตูู ูุงุชูุฑุฉ
- ุฃุถู ุฏูุนุฉ ุฌุฏูุฏุฉ
- ุฃุบูู ุงูุชูุงุตูู
- ุณุชุฌุฏ ูุงุฆูุฉ ุงูููุงุชูุฑ ูุญุฏุซุฉ ููุฑุงู

## ๐ง ุงูุชูุงุตูู ุงูุชูููุฉ:

### **ุนุฑุถ ุงููุฏููุนุงุช ุฏุงุฆูุงู**:
- ุฅุฒุงูุฉ ุงูุดุฑุท `{invoice.paid_amount > 0 &&`
- ุฅุถุงูุฉ ููู ุงูุชุฑุงุถูุฉ `|| 0` ู `|| invoice.amount`
- ุนุฑุถ ุงููุฏููุนุงุช ูุงููุชุจูู ูุฌููุน ุงูููุงุชูุฑ

### **ุฅุตูุงุญ ูุดููุฉ ุงูุตูุญุฉ ุงููุงุฑุบุฉ**:
- ุชูุญูุฏ props: `open` ู `onOpenChange`
- ุงุณุชุฎุฏุงู callback ุตุญูุญ ูุฅุบูุงู ุงููุงูุฐุฉ
- ุฅุฏุงุฑุฉ state ุตุญูุญุฉ ูููุงุชูุฑุฉ ุงููุฎุชุงุฑุฉ

### **ุงูุชุญุฏูุซ ุงูุชููุงุฆู**:
- invalidate queries ุนูุฏ ุฅุถุงูุฉ/ุญุฐู ุงููุฏููุนุงุช
- ุชุญุฏูุซ ุฌููุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ
- staleTime ุฃูุตุฑ ูููุฏููุนุงุช (2 ุฏูููุฉ)

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

### โ **ูุงุฆูุฉ ุงูููุงุชูุฑ ูุญุณูุฉ**:
- ุนุฑุถ ูุงุถุญ ูููุฏููุนุงุช ูุงููุชุจูู
- ุฃููุงู ูููุฒุฉ (ุฃุฎุถุฑ ูููุฏููุนุ ุฃุญูุฑ ูููุชุจูู)
- ูุนูููุงุช ุดุงููุฉ ููู ูุงุชูุฑุฉ

### โ **ุชููู ุณูุณ**:
- ูุชุญ ุงูุชูุงุตูู ุจุฏูู ูุดุงูู
- ุฎุฑูุฌ ุตุญูุญ ุฅูู ูุงุฆูุฉ ุงูููุงุชูุฑ
- ูุง ูุฒูุฏ ูู ุงูุตูุญุงุช ุงููุงุฑุบุฉ

### โ **ุชุญุฏูุซ ููุฑู**:
- ุชุฒุงูู ูุงูู ุจูู ุฌููุน ุงูุตูุญุงุช
- ุชุญุฏูุซ ุชููุงุฆู ููุจูุงูุงุช
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ

**ุงูุขู ูุงุฆูุฉ ุงูููุงุชูุฑ ุชุนุฑุถ ุงููุฏููุนุงุช ุจูุถูุญ ูุงูุชููู ูุนูู ุจุดูู ูุซุงูู!** ๐ฏโจ

---

## ๐ ููุงุญุธุงุช ูููุฉ:

1. **ุงููุฏููุนุงุช ุชุธูุฑ ุฏุงุฆูุงู** ูู ูุงุฆูุฉ ุงูููุงุชูุฑ
2. **ุงูุฎุฑูุฌ ูู ุงูุชูุงุตูู ูุนูู ุจุดูู ุตุญูุญ** 
3. **ุงูุชุญุฏูุซ ุชููุงุฆู ูููุฑู** ุนูุฏ ุฅุถุงูุฉ/ุญุฐู ุงููุฏููุนุงุช
4. **ุชุฒุงูู ูุงูู** ุจูู ุฌููุน ุฃุฌุฒุงุก ุงูุชุทุจูู

**ุงุณุชูุชุน ุจุงูุชุฌุฑุจุฉ ุงููุญุณูุฉ!** ๐
